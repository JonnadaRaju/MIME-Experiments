<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIME Types Testing Interface</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        
        .content { padding: 30px; }
        
        .category {
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            margin-bottom: 25px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .category:hover {
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .category-header {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }
        
        .category-header:hover {
            background: linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);
        }
        
        .category-header h2 {
            color: #4a5568;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .icon {
            width: 24px;
            height: 24px;
            display: inline-block;
        }
        
        .toggle {
            font-size: 1.2rem;
            color: #667eea;
            transition: transform 0.3s ease;
        }
        
        .category-header.active .toggle {
            transform: rotate(180deg);
        }
        
        .endpoints {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: #fafafa;
        }
        
        .endpoints.active {
            max-height: 1000px;
        }
        
        .endpoint-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 15px;
            padding: 20px;
        }
        
        .endpoint { 
            background: white; 
            border: 1px solid #e2e8f0; 
            border-radius: 10px; 
            padding: 20px; 
            transition: all 0.3s ease;
            position: relative;
        }
        
        .endpoint:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.1); 
            border-color: #667eea;
        }
        
        .endpoint-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .method { 
            display: inline-block; 
            padding: 4px 12px; 
            border-radius: 20px; 
            font-size: 0.75rem; 
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .get { background: #48bb78; color: white; }
        .post { background: #4299e1; color: white; }
        
        .path { 
            font-family: 'Courier New', monospace; 
            font-weight: 600; 
            color: #2d3748; 
            font-size: 0.85rem;
        }
        
        .description { 
            color: #718096; 
            margin: 8px 0; 
            font-size: 0.9rem;
        }
        
        .test-btn { 
            background: linear-gradient(135deg, #667eea 0%, #5a67d8 100%); 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }
        
        .test-btn:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .test-btn:active {
            transform: translateY(0);
        }
        
        .test-btn.loading {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
            cursor: not-allowed;
        }
        
        .response-area {
            margin-top: 15px;
            display: none;
        }
        
        .response-area.active {
            display: block;
        }
        
        .response-tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 15px;
        }
        
        .response-tab {
            padding: 8px 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #718096;
            transition: all 0.3s ease;
        }
        
        .response-tab.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }
        
        .response-content {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow: auto;
            white-space: pre-wrap;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-success {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .status-error {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .upload-section {
            padding: 20px;
            background: white;
        }
        
        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin: 15px 0;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #667eea;
            background: #f7fafc;
        }
        
        .upload-area.dragover {
            border-color: #667eea;
            background: #edf2f7;
            transform: scale(1.02);
        }
        
        .file-input {
            margin: 15px 0;
        }
        
        .file-input input[type="file"] {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #5a67d8 100%);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .file-label:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ MIME Types Testing Interface</h1>
            <p>Comprehensive testing environment for all MIME types with detailed response analysis</p>
        </div>
        
        <div class="content">
            <!-- Statistics -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalTests">0</div>
                    <div class="stat-label">Total Tests Run</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="successRate">0%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgResponseTime">0ms</div>
                    <div class="stat-label">Avg Response Time</div>
                </div>
            </div>

            <!-- Text Category -->
            <div class="category">
                <div class="category-header" onclick="toggleCategory('text')">
                    <h2>
                        <span class="icon">üìù</span>
                        Text MIME Types
                    </h2>
                    <span class="toggle">‚ñº</span>
                </div>
                <div class="endpoints" id="text-endpoints">
                    <div class="endpoint-grid">
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/text/plain</span>
                                </div>
                            </div>
                            <div class="description">Plain text content with text/plain MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('text/plain', 'GET', '/api/text/plain', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-text/plain"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/text/html</span>
                                </div>
                            </div>
                            <div class="description">HTML content with text/html MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('text/html', 'GET', '/api/text/html', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-text/html"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/text/css</span>
                                </div>
                            </div>
                            <div class="description">CSS stylesheet with text/css MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('text/css', 'GET', '/api/text/css', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-text/css"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/text/javascript</span>
                                </div>
                            </div>
                            <div class="description">JavaScript code with text/javascript MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('text/javascript', 'GET', '/api/text/javascript', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-text/javascript"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/text/csv</span>
                                </div>
                            </div>
                            <div class="description">CSV data with text/csv MIME type (download)</div>
                            <button class="test-btn" onclick="testEndpoint('text/csv', 'GET', '/api/text/csv', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-text/csv"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Application Category -->
            <div class="category">
                <div class="category-header" onclick="toggleCategory('application')">
                    <h2>
                        <span class="icon">‚öôÔ∏è</span>
                        Application MIME Types
                    </h2>
                    <span class="toggle">‚ñº</span>
                </div>
                <div class="endpoints" id="application-endpoints">
                    <div class="endpoint-grid">
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/application/json</span>
                                </div>
                            </div>
                            <div class="description">JSON data with application/json MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('application/json', 'GET', '/api/application/json', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-application/json"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/application/xml</span>
                                </div>
                            </div>
                            <div class="description">XML data with application/xml MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('application/xml', 'GET', '/api/application/xml', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-application/xml"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/application/pdf</span>
                                </div>
                            </div>
                            <div class="description">PDF document with application/pdf MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('application/pdf', 'GET', '/api/application/pdf', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-application/pdf"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/application/zip</span>
                                </div>
                            </div>
                            <div class="description">ZIP archive with application/zip MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('application/zip', 'GET', '/api/application/zip', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-application/zip"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/application/octet-stream</span>
                                </div>
                            </div>
                            <div class="description">Binary data with application/octet-stream MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('application/octet-stream', 'GET', '/api/application/octet-stream', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-application/octet-stream"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Image Category -->
            <div class="category">
                <div class="category-header" onclick="toggleCategory('image')">
                    <h2>
                        <span class="icon">üñºÔ∏è</span>
                        Image MIME Types
                    </h2>
                    <span class="toggle">‚ñº</span>
                </div>
                <div class="endpoints" id="image-endpoints">
                    <div class="endpoint-grid">
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/image/jpeg</span>
                                </div>
                            </div>
                            <div class="description">JPEG image with image/jpeg MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('image/jpeg', 'GET', '/api/image/jpeg', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-image/jpeg"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/image/png</span>
                                </div>
                            </div>
                            <div class="description">PNG image with image/png MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('image/png', 'GET', '/api/image/png', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-image/png"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/image/svg+xml</span>
                                </div>
                            </div>
                            <div class="description">SVG vector image with image/svg+xml MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('image/svg+xml', 'GET', '/api/image/svg+xml', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-image/svg+xml"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/image/gif</span>
                                </div>
                            </div>
                            <div class="description">Animated GIF with image/gif MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('image/gif', 'GET', '/api/image/gif', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-image/gif"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Video Category -->
            <div class="category">
                <div class="category-header" onclick="toggleCategory('video')">
                    <h2>
                        <span class="icon">üé•</span>
                        Video MIME Types
                    </h2>
                    <span class="toggle">‚ñº</span>
                </div>
                <div class="endpoints" id="video-endpoints">
                    <div class="endpoint-grid">
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/video/mp4</span>
                                </div>
                            </div>
                            <div class="description">MP4 video with video/mp4 MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('video/mp4', 'GET', '/api/video/mp4', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-video/mp4"></div>
                        </div>
                        
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/video/webm</span>
                                </div>
                            </div>
                            <div class="description">WebM video with video/webm MIME type</div>
                            <button class="test-btn" onclick="testEndpoint('video/webm', 'GET', '/api/video/webm', this)">
                                Test Endpoint
                            </button>
                            <div class="response-area" id="response-video/webm"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Headers & CORS Testing Category -->
            <div class="category">
                <div class="category-header" onclick="toggleCategory('headers')">
                    <h2>
                        <span class="icon">üîß</span>
                        Headers & CORS Testing
                    </h2>
                    <span class="toggle">‚ñº</span>
                </div>
                <div class="endpoints" id="headers-endpoints">
                    <div class="endpoint-grid">
                        <div class="endpoint">
                            <div class="endpoint-header">
                                <div>
                                    <span class="method get">GET</span>
                                    <span class="path">/api/headers-demo</span>
                                </div>
                            </div>
                            <div class="description">Test CORS header exposure and custom headers visibility</div>
                            <button class="test-btn" onclick="testEndpoint('headers-demo', 'GET', '/api/headers-demo', this)">
                                Test Headers & CORS
                            </button>
                            <div class="response-area" id="response-headers-demo"></div>
                        </div>
                        
                        <div class="endpoint" style="background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); border: 2px solid #667eea;">
                            <div style="padding: 20px;">
                                <h3 style="color: #4a5568; margin-bottom: 15px;">üîç Header Testing Tips:</h3>
                                <ul style="color: #718096; line-height: 1.6;">
                                    <li><strong>Check Headers Tab:</strong> Look for X-Custom-* headers</li>
                                    <li><strong>Browser DevTools:</strong> Use Network tab for complete headers</li>
                                    <li><strong>CORS Exposed Headers:</strong> Should show all headers due to expose_headers=["*"]</li>
                                    <li><strong>Response Headers:</strong> Content-Type, Content-Length, etc.</li>
                                    <li><strong>Debug Info:</strong> Header object type and method availability</li>
                                </ul>
                                <div style="background: #fef5e7; padding: 12px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #f39c12;">
                                    <strong>üö® If headers are missing:</strong>
                                    <ul style="margin: 8px 0 0 20px; color: #7f8c8d;">
                                        <li>Check browser console for CORS errors</li>
                                        <li>Verify server expose_headers configuration</li>
                                        <li>Some headers are filtered by browser security</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Upload Category -->
            <div class="category">
                <div class="category-header" onclick="toggleCategory('upload')">
                    <h2>
                        <span class="icon">üìÅ</span>
                        File Upload Testing
                    </h2>
                    <span class="toggle">‚ñº</span>
                </div>
                <div class="endpoints" id="upload-endpoints">
                    <div class="upload-section">
                        <div class="endpoint-grid">
                            <div class="endpoint">
                                <div class="endpoint-header">
                                    <div>
                                        <span class="method post">POST</span>
                                        <span class="path">/api/upload/single</span>
                                    </div>
                                </div>
                                <div class="description">Upload single file and analyze MIME type</div>
                                
                                <div class="upload-area" id="singleUploadArea" ondrop="handleDrop(event, 'single')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                                    <div class="file-input">
                                        <label for="singleFile" class="file-label">Choose File</label>
                                        <input type="file" id="singleFile" onchange="handleFileSelect('single', this)">
                                    </div>
                                    <p style="margin: 10px 0; color: #718096;">or drag and drop file here</p>
                                    <div id="singleFileName" style="color: #4a5568; font-weight: 600;"></div>
                                </div>
                                
                                <button class="test-btn" onclick="testUpload('single')">
                                    Upload & Test
                                </button>
                                <div class="response-area" id="response-upload-single"></div>
                            </div>
                            
                            <div class="endpoint">
                                <div class="endpoint-header">
                                    <div>
                                        <span class="method post">POST</span>
                                        <span class="path">/api/upload/multiple</span>
                                    </div>
                                </div>
                                <div class="description">Upload multiple files and analyze MIME types</div>
                                
                                <div class="upload-area" id="multipleUploadArea" ondrop="handleDrop(event, 'multiple')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                                    <div class="file-input">
                                        <label for="multipleFiles" class="file-label">Choose Files</label>
                                        <input type="file" id="multipleFiles" multiple onchange="handleFileSelect('multiple', this)">
                                    </div>
                                    <p style="margin: 10px 0; color: #718096;">or drag and drop files here</p>
                                    <div id="multipleFileNames" style="color: #4a5568; font-weight: 600;"></div>
                                </div>
                                
                                <button class="test-btn" onclick="testUpload('multiple')">
                                    Upload & Test
                                </button>
                                <div class="response-area" id="response-upload-multiple"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let totalTests = 0;
        let successfulTests = 0;
        let responseTimes = [];
        
        function toggleCategory(category) {
            const header = event.currentTarget;
            const endpoints = document.getElementById(category + '-endpoints');
            const toggle = header.querySelector('.toggle');
            
            header.classList.toggle('active');
            endpoints.classList.toggle('active');
        }
        
        async function testEndpoint(mimeType, method, url, button) {
            const originalText = button.textContent;
            button.textContent = 'Testing...';
            button.classList.add('loading');
            button.disabled = true;
            
            const startTime = Date.now();
            const responseArea = document.getElementById('response-' + mimeType.replace(/[\/\+]/g, ''));
            
            try {
                const response = await fetch(url, { method });
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                totalTests++;
                successfulTests++;
                responseTimes.push(responseTime);
                updateStats();
                
                // Get ALL headers for debugging - better method for CORS
                const allHeaders = {};
                try {
                    // Method 1: Using forEach (most reliable)
                    response.headers.forEach((value, key) => {
                        allHeaders[key] = value;
                    });
                    
                    // Method 2: Using entries() as backup
                    if (Object.keys(allHeaders).length === 0) {
                        for (const [key, value] of response.headers.entries()) {
                            allHeaders[key] = value;
                        }
                    }
                    
                    // Method 3: Manual check for common headers (fallback)
                    const commonHeaders = [
                        'content-type', 'content-disposition', 'content-length', 
                        'cache-control', 'expires', 'etag', 'last-modified',
                        'server', 'date', 'connection', 'transfer-encoding'
                    ];
                    
                    commonHeaders.forEach(header => {
                        if (!allHeaders[header]) {
                            const value = response.headers.get(header);
                            if (value) allHeaders[header] = value;
                        }
                    });
                } catch (error) {
                    console.error('Error accessing headers:', error);
                }
                
                const contentType = allHeaders['content-type'] || response.headers.get('content-type');
                const contentDisposition = allHeaders['content-disposition'] || response.headers.get('content-disposition');
                const contentLength = allHeaders['content-length'] || response.headers.get('content-length');
                
                let responseData;
                const contentTypeLower = contentType?.toLowerCase();
                
                if (contentTypeLower?.includes('application/json')) {
                    responseData = await response.json();
                } else if (contentTypeLower?.includes('text/') && !contentTypeLower?.includes('html')) {
                    responseData = await response.text();
                } else if (contentTypeLower?.includes('image/')) {
                    const blob = await response.blob();
                    responseData = {
                        type: 'Binary Image Data',
                        size: blob.size,
                        contentType: contentType,
                        dataUrl: `data:${contentType};base64,${await blobToBase64(blob)}`
                    };
                } else if (contentTypeLower?.includes('application/pdf') || contentTypeLower?.includes('application/zip') || contentTypeLower?.includes('application/octet-stream')) {
                    const blob = await response.blob();
                    responseData = {
                        type: 'Binary File Data',
                        size: blob.size,
                        contentType: contentType,
                        filename: contentDisposition?.match(/filename="?([^"]+)"?/)?.[1] || 'unknown'
                    };
                } else {
                    responseData = await response.text();
                }
                
                displayResponse(responseArea, {
                    status: response.status,
                    statusText: response.statusText,
                    responseTime,
                    headers: allHeaders,
                    keyHeaders: {
                        'Content-Type': contentType,
                        'Content-Disposition': contentDisposition,
                        'Content-Length': contentLength
                    },
                    data: responseData,
                    success: true
                });
                
            } catch (error) {
                totalTests++;
                updateStats();
                
                displayResponse(responseArea, {
                    status: 'ERROR',
                    statusText: error.message,
                    responseTime: Date.now() - startTime,
                    headers: {},
                    data: { error: error.message },
                    success: false
                });
            } finally {
                button.textContent = originalText;
                button.classList.remove('loading');
                button.disabled = false;
            }
        }
        
        async function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }
        
        function displayResponse(responseArea, response) {
            responseArea.innerHTML = `
                <div class="response-tabs">
                    <button class="response-tab active" onclick="showTab('info', '${responseArea.id}')">Info</button>
                    <button class="response-tab" onclick="showTab('headers', '${responseArea.id}')">Headers</button>
                    <button class="response-tab" onclick="showTab('data', '${responseArea.id}')">Data</button>
                </div>
                
                <div class="response-content" id="${responseArea.id}-info">
                    <strong>Status:</strong> ${response.status} ${response.statusText}
                    ${response.success ? '<span class="status-indicator status-success">‚úì Success</span>' : '<span class="status-indicator status-error">‚úó Error</span>'}<br>
                    <strong>Response Time:</strong> ${response.responseTime}ms<br>
                    <strong>MIME Type:</strong> ${response.keyHeaders?.['Content-Type'] || 'Not specified'}<br>
                    <strong>Content Length:</strong> ${response.keyHeaders?.['Content-Length'] || 'Unknown'} bytes<br>
                    ${response.keyHeaders?.['Content-Disposition'] ? `<strong>Content-Disposition:</strong> ${response.keyHeaders['Content-Disposition']}<br>` : ''}
                </div>
                
                <div class="response-content" style="display: none;" id="${responseArea.id}-headers">
                    <strong>HTTP Response:</strong><br><br>
                    <pre style="color: #68d391; font-size: 0.9rem; background: #1a202c; padding: 15px; border-radius: 8px;">HTTP/1.1 ${response.status} ${response.statusText}
Content-Type: ${response.keyHeaders?.['Content-Type'] || 'application/octet-stream'}
Content-Length: ${response.keyHeaders?.['Content-Length'] || '0'}
Cache-Control: ${response.keyHeaders?.['Cache-Control'] || 'no-cache'}
Connection: keep-alive
Date: ${new Date().toUTCString()}
Server: uvicorn${Object.keys(response.headers).length > 0 ? 
    Object.keys(response.headers).filter(key => !['content-type', 'content-length', 'cache-control', 'connection', 'date', 'server'].includes(key.toLowerCase()))
        .map(key => `\n${key}: ${response.headers[key]}`).join('') : ''}</pre>
                    
                    <br><strong>Raw Response Headers:</strong> (${Object.keys(response.headers).length} headers found)<br><br>
                    <pre style="color: #a0aec0; font-size: 0.8rem;">${JSON.stringify(response.headers, null, 2)}</pre>
                    
                    ${Object.keys(response.keyHeaders).length > 0 ? `
                        <br><strong>Key MIME Headers:</strong><br><br>
                        <pre style="color: #68d391; font-size: 0.9rem;">${JSON.stringify(response.keyHeaders, null, 2)}</pre>
                    ` : ''}
                    
                    <br><strong>Header Debugging Info:</strong><br><br>
                    <pre style="color: #fbb6ce; font-size: 0.8rem;">
Headers Object Type: ${typeof response.headers}
Headers Iterator Available: ${typeof response.headers.forEach === 'function'}
Headers Entries Method: ${typeof response.headers.entries === 'function'}
Response CORS Mode: ${response.type || 'basic'}
                    </pre>
                </div>
                
                <div class="response-content" style="display: none;" id="${responseArea.id}-data">
                    ${response.data?.dataUrl ? `
                        <strong>Image Preview:</strong><br>
                        <img src="${response.data.dataUrl}" style="max-width: 100%; border-radius: 8px; margin: 10px 0;">
                        <br><strong>Image Info:</strong><br>
                    ` : ''}
                    <pre style="white-space: pre-wrap; word-wrap: break-word;">${JSON.stringify(response.data, null, 2)}</pre>
                </div>
            `;
            
            responseArea.classList.add('active');
        }
        
        function showTab(tabName, responseAreaId) {
            const responseArea = document.getElementById(responseAreaId);
            const tabs = responseArea.querySelectorAll('.response-tab');
            const contents = responseArea.querySelectorAll('.response-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.style.display = 'none');
            
            event.target.classList.add('active');
            document.getElementById(responseAreaId + '-' + tabName).style.display = 'block';
        }
        
        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }
        
        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }
        
        function handleDrop(event, type) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = Array.from(event.dataTransfer.files);
            const input = document.getElementById(type === 'single' ? 'singleFile' : 'multipleFiles');
            
            input.files = event.dataTransfer.files;
            handleFileSelect(type, input);
        }
        
        function handleFileSelect(type, input) {
            const namesDiv = document.getElementById(type === 'single' ? 'singleFileName' : 'multipleFileNames');
            
            if (type === 'single') {
                namesDiv.textContent = input.files[0] ? `Selected: ${input.files[0].name}` : '';
            } else {
                const fileNames = Array.from(input.files).map(file => file.name);
                namesDiv.textContent = fileNames.length > 0 ? `Selected ${fileNames.length} files: ${fileNames.join(', ')}` : '';
            }
        }
        
        async function testUpload(type) {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Uploading...';
            button.classList.add('loading');
            button.disabled = true;
            
            const responseArea = document.getElementById('response-upload-' + type);
            const startTime = Date.now();
            
            try {
                const formData = new FormData();
                const input = document.getElementById(type === 'single' ? 'singleFile' : 'multipleFiles');
                
                if (type === 'single') {
                    if (!input.files[0]) {
                        throw new Error('Please select a file');
                    }
                    formData.append('file', input.files[0]);
                } else {
                    if (input.files.length === 0) {
                        throw new Error('Please select files');
                    }
                    for (let file of input.files) {
                        formData.append('files', file);
                    }
                }
                
                const response = await fetch(`/api/upload/${type}`, {
                    method: 'POST',
                    body: formData
                });
                
                const endTime = Date.now();
                const responseData = await response.json();
                
                totalTests++;
                successfulTests++;
                responseTimes.push(endTime - startTime);
                updateStats();
                
                displayResponse(responseArea, {
                    status: response.status,
                    statusText: response.statusText,
                    responseTime: endTime - startTime,
                    headers: {
                        'Content-Type': response.headers.get('content-type')
                    },
                    data: responseData,
                    success: response.ok
                });
                
            } catch (error) {
                totalTests++;
                updateStats();
                
                displayResponse(responseArea, {
                    status: 'ERROR',
                    statusText: error.message,
                    responseTime: Date.now() - startTime,
                    headers: {},
                    data: { error: error.message },
                    success: false
                });
            } finally {
                button.textContent = originalText;
                button.classList.remove('loading');
                button.disabled = false;
            }
        }
        
        function updateStats() {
            document.getElementById('totalTests').textContent = totalTests;
            document.getElementById('successRate').textContent = totalTests > 0 ? Math.round((successfulTests / totalTests) * 100) + '%' : '0%';
            
            if (responseTimes.length > 0) {
                const avgTime = Math.round(responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length);
                document.getElementById('avgResponseTime').textContent = avgTime + 'ms';
            }
        }
        
        // Open first category by default
        document.addEventListener('DOMContentLoaded', function() {
            toggleCategory('text');
        });
    </script>
</body>
</html>