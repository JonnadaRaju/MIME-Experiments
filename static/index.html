<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPI MIME Types Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 30px auto;
            max-width: 1200px;
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        .category-section {
            padding: 30px;
            border-bottom: 1px solid #e9ecef;
        }
        .category-section:last-child {
            border-bottom: none;
        }
        .category-title {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 3px solid #4ECDC4;
        }
        .endpoint-card {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        .endpoint-card:hover {
            border-color: #4ECDC4;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.2);
        }
        .method-badge {
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        .get-badge { background-color: #28a745; color: white; }
        .post-badge { background-color: #007bff; color: white; }
        .url-text {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            font-size: 0.9rem;
            word-break: break-all;
        }
        .test-btn {
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
            color: white;
        }
        .upload-area {
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        .upload-area:hover {
            border-color: #4ECDC4;
            background: #e8f8f7;
        }
        .response-container {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
        }
        .feature-highlight {
            background: linear-gradient(135deg, #FFEAA7 0%, #FAB1A0 100%);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <h1 class="display-4 fw-bold">üöÄ FastAPI MIME Types Demo</h1>
            <p class="lead mb-0">Comprehensive MIME type handling with automatic detection and file upload capabilities</p>
            <div class="mt-3">
                <span class="badge bg-light text-dark me-2">FastAPI</span>
                <span class="badge bg-light text-dark me-2">Python</span>
                <span class="badge bg-light text-dark me-2">MIME Types</span>
                <span class="badge bg-light text-dark">Auto-Detection</span>
            </div>
        </div>

        <div class="container-fluid p-0">
            <!-- Quick Actions -->
            <div class="feature-highlight mx-4 mt-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h5 class="mb-2">üéØ Quick Start</h5>
                        <p class="mb-0">Test endpoints directly here, or use <a href="/docs" target="_blank" class="fw-bold">Swagger UI</a> for interactive documentation</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <button class="btn btn-success me-2" onclick="window.open('/docs', '_blank')">
                            üìñ Swagger Docs
                        </button>
                        <button class="btn btn-info" onclick="loadAllEndpoints()">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="px-4 pt-4">
                <ul class="nav nav-pills" id="categoryTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="text-tab" data-bs-toggle="tab" data-bs-target="#text" type="button" role="tab">
                            üìù Text
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="application-tab" data-bs-toggle="tab" data-bs-target="#application" type="button" role="tab">
                            üì¶ Application
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="image-tab" data-bs-toggle="tab" data-bs-target="#image" type="button" role="tab">
                            üñºÔ∏è Images
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="video-tab" data-bs-toggle="tab" data-bs-target="#video" type="button" role="tab">
                            üé• Video
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload" type="button" role="tab">
                            üì§ Upload
                        </button>
                    </li>
                </ul>
            </div>

            <!-- Tab Content -->
            <div class="tab-content px-4 pb-4" id="categoryContent">
                <!-- Text MIME Types -->
                <div class="tab-pane fade show active" id="text" role="tabpanel">
                    <div class="category-section">
                        <h3 class="category-title">üìù Text MIME Types</h3>
                        <div id="text-endpoints"></div>
                    </div>
                </div>

                <!-- Application MIME Types -->
                <div class="tab-pane fade" id="application" role="tabpanel">
                    <div class="category-section">
                        <h3 class="category-title">üì¶ Application MIME Types</h3>
                        <div id="application-endpoints"></div>
                    </div>
                </div>

                <!-- Image MIME Types -->
                <div class="tab-pane fade" id="image" role="tabpanel">
                    <div class="category-section">
                        <h3 class="category-title">üñºÔ∏è Image MIME Types</h3>
                        <div id="image-endpoints"></div>
                    </div>
                </div>

                <!-- Video MIME Types -->
                <div class="tab-pane fade" id="video" role="tabpanel">
                    <div class="category-section">
                        <h3 class="category-title">üé• Video MIME Types</h3>
                        <div id="video-endpoints"></div>
                    </div>
                </div>

                <!-- Upload Endpoints -->
                <div class="tab-pane fade" id="upload" role="tabpanel">
                    <div class="category-section">
                        <h3 class="category-title">üì§ File Upload</h3>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="upload-area">
                                    <h5>üìÅ Single File Upload</h5>
                                    <p class="text-muted mb-3">Upload any file to see MIME type detection</p>
                                    <input type="file" id="singleFile" class="form-control mb-3">
                                    <button class="btn btn-primary" onclick="uploadSingleFile()">Upload File</button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="upload-area">
                                    <h5>üìÅ Multiple File Upload</h5>
                                    <p class="text-muted mb-3">Upload multiple files at once</p>
                                    <input type="file" id="multipleFiles" class="form-control mb-3" multiple>
                                    <button class="btn btn-primary" onclick="uploadMultipleFiles()">Upload Files</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Response Container -->
            <div class="mx-4 mb-4">
                <div class="response-container" id="responseContainer">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0">üì° Response</h6>
                        <button class="btn btn-sm btn-outline-light" onclick="clearResponse()">Clear</button>
                    </div>
                    <pre id="responseContent"></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let endpoints = {};

        async function loadAllEndpoints() {
            try {
                const response = await fetch('/api/endpoints');
                endpoints = await response.json();
                renderEndpoints();
                showResponse('‚úÖ Endpoints loaded successfully!', 'success');
            } catch (error) {
                showResponse('‚ùå Failed to load endpoints: ' + error.message, 'error');
            }
        }

        function renderEndpoints() {
            const categories = ['text', 'application', 'image', 'video'];
            
            categories.forEach(category => {
                const container = document.getElementById(`${category}-endpoints`);
                if (!container || !endpoints.endpoints[category]) return;
                
                container.innerHTML = endpoints.endpoints[category].map(endpoint => `
                    <div class="endpoint-card">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <span class="method-badge ${endpoint.method.toLowerCase()}-badge">${endpoint.method}</span>
                            </div>
                            <div class="col-md-5">
                                <div class="url-text">${endpoint.path}</div>
                            </div>
                            <div class="col-md-3">
                                <small class="text-muted">${endpoint.description}</small>
                            </div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-sm test-btn" onclick="testEndpoint('${endpoint.method}', '${endpoint.path}')">
                                    Test
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            });
        }

        async function testEndpoint(method, path) {
            try {
                showResponse(`üöÄ Testing ${method} ${path}...`, 'info');
                
                const options = {
                    method: method,
                    headers: {}
                };

                const response = await fetch(path, options);
                const contentType = response.headers.get('content-type');
                
                let responseData;
                if (contentType && contentType.includes('application/json')) {
                    responseData = await response.json();
                } else if (contentType && (contentType.includes('text/') || contentType.includes('application/xml'))) {
                    responseData = await response.text();
                } else {
                    responseData = `[Binary data - ${contentType}]`;
                }

                showResponse({
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries()),
                    data: responseData,
                    contentType: contentType
                }, 'success');
            } catch (error) {
                showResponse('‚ùå Request failed: ' + error.message, 'error');
            }
        }

        async function uploadSingleFile() {
            const fileInput = document.getElementById('singleFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showResponse('‚ùå Please select a file', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                showResponse('üì§ Uploading file...', 'info');
                
                const response = await fetch('/api/upload/single', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                showResponse(result, 'success');
            } catch (error) {
                showResponse('‚ùå Upload failed: ' + error.message, 'error');
            }
        }

        async function uploadMultipleFiles() {
            const fileInput = document.getElementById('multipleFiles');
            const files = fileInput.files;
            
            if (files.length === 0) {
                showResponse('‚ùå Please select files', 'error');
                return;
            }

            const formData = new FormData();
            for (let file of files) {
                formData.append('files', file);
            }

            try {
                showResponse(`üì§ Uploading ${files.length} files...`, 'info');
                
                const response = await fetch('/api/upload/multiple', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                showResponse(result, 'success');
            } catch (error) {
                showResponse('‚ùå Upload failed: ' + error.message, 'error');
            }
        }

        function showResponse(data, type = 'info') {
            const container = document.getElementById('responseContainer');
            const content = document.getElementById('responseContent');
            
            container.style.display = 'block';
            
            if (typeof data === 'string') {
                content.textContent = data;
            } else {
                content.textContent = JSON.stringify(data, null, 2);
            }
            
            // Add syntax highlighting effect
            content.style.color = type === 'error' ? '#fc8181' : 
                                 type === 'success' ? '#68d391' : 
                                 type === 'info' ? '#63b3ed' : '#e2e8f0';
        }

        function clearResponse() {
            const container = document.getElementById('responseContainer');
            container.style.display = 'none';
        }

        // Load endpoints on page load
        document.addEventListener('DOMContentLoaded', loadAllEndpoints);
    </script>
</body>
</html>